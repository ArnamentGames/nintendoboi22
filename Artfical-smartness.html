<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Artificial Smartness</title>
        <link rel="icon" type="image/jpg" href="favicon.jpg?v2" />
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="styleai.css">
        <script type="module" src="core.js"></script>
        <meta charset="UTF-8">
        <meta property="og:title" content="Nintendoboi2's Website" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://nintendoboi22.github.io/" />
        <meta property="og:image" content="https://nintendoboi22.github.io/favicon.jpg" />
        <meta property="og:description" content="I made this website at school bc I wanted to play games" />
        <meta name="theme-color" media="(prefers-color-scheme: light)" content="5500ff" />
        <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#2c0085" />
        <meta name="twitter:card" content="summary_large_image">
        <style>
            body {
                background-image: url('spcae.gif');
                background-attachment: fixed; 
                background-size: 100% 100%;
                font-family: 'Press Start 2P';
            }
            #chat-container {
                width: 600px;
                margin: 0 auto;
            }
            #chat-log {
                border: 1px solid #20C20E;
                height: 300px;
                overflow-y: auto;
                padding: 10px;
                margin-bottom: 10px;
            }
            #user-input {
                width: calc(100% - 110px);
                padding: 10px;
            }
            #send-btn, #reset-btn {
                padding: 10px;
                margin-left: 10px;
            }
        </style>
    </head>
    <body>
        <h1>OpenAI Chatbot</h1>
        <div id="chat-container">
            <div id="chat-log"></div>
            <input type="text" id="user-input" placeholder="Type your message here...">
            <button id="send-btn">Send</button>
            <button id="reset-btn">Reset</button>
        </div>
        
        <script>
            async function fetch_response(inputText) {
                const apiKey = pyodide.globals.get("openai_api_key");
                const url = "https://api.openai.com/v1/chat/completions";
                
                const response = await fetch(url, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: "gpt-3.5-turbo",
                        messages: [{"role": "system", "content": "You are an AI chatbot."}, {"role": "user", "content": inputText}],
                        max_tokens: 100
                    })
                });
                
                const data = await response.json();
                const resultText = data.choices[0].message.content.trim();
                
                // Call the Python function to display the result
                pyodide.globals.add_message("chatbot", resultText);
            }

            // Expose the fetch_response function to PyScript
            window.fetch_response = fetch_response;
        </script>

        <script type="py" src="./ai.py" config="./pyscript.toml" terminal></script>
    </body>
</html>
