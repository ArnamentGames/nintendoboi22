import{T as e,X as t,d as r,a as n,r as o,o as s,H as i,s as a}from"./core-XJOBvPX-.js";let c=0;const l=e=>`${e}-editor-${c++}`,d=new Map,u=new Map,p={worker:{codeBeforeRun:()=>a,onReady:({runAsync:e,io:t},{sync:r})=>{t.stdout=t.buffered(r.write),t.stderr=t.buffered(r.writeErr),r.revoke(),r.runAsync=e}}};async function m({currentTarget:e}){const{env:r,pySrc:n,outDiv:a}=this,c=!!e;if(c&&(e.disabled=!0,a.innerHTML=""),!d.has(r)){const e=URL.createObjectURL(new Blob([""])),n={type:this.interpreter,serviceWorker:this.serviceWorker},{config:a}=this;if(a){if(n.configURL=o(a),a.endsWith(".toml")){const[{parse:e},t]=await Promise.all([import("./toml-CvAfdf9_.js"),fetch(a).then((e=>e.text()))]);n.config=e(t)}else a.endsWith(".json")?n.config=await fetch(a).then((e=>e.json())):(n.configURL=o("./config.txt"),n.config=JSON.parse(a));n.version=s(n.config)}else n.config={};const c=t.call(new i(null,p),e,n),{sync:l}=c,{promise:u,resolve:m}=Promise.withResolvers();d.set(r,u),l.revoke=()=>{URL.revokeObjectURL(e),m(c)}}return d.get(r).then((t=>{t.onerror=({error:e})=>{c&&(a.innerHTML+=`<span style='color:red'>${e.message||e}</span>\n`),console.error(e)};const r=()=>{c&&(e.disabled=!1)},{sync:o}=t;o.write=e=>{c&&(a.innerText+=`${e}\n`)},o.writeErr=e=>{c&&(a.innerHTML+=`<span style='color:red'>${e}</span>\n`)},o.runAsync(n).then(r,r)}))}const g=(e,t)=>{const r=document.createElement("div");r.className=`${t}-editor-input`,r.setAttribute("aria-label","Python Script Area");const n=((e,t)=>{const r=document.createElement("button");return r.className=`absolute ${t}-editor-run-button`,r.innerHTML='<svg style="height:20px;width:20px;vertical-align:-.125em;transform-origin:center;overflow:visible;color:green" viewBox="0 0 384 512" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg"><g transform="translate(192 256)" transform-origin="96 0"><g transform="translate(0,0) scale(1,1)"><path d="M361 215C375.3 223.8 384 239.3 384 256C384 272.7 375.3 288.2 361 296.1L73.03 472.1C58.21 482 39.66 482.4 24.52 473.9C9.377 465.4 0 449.4 0 432V80C0 62.64 9.377 46.63 24.52 38.13C39.66 29.64 58.21 29.99 73.03 39.04L361 215z" fill="currentColor" transform="translate(-192 -256)"></path></g></g></svg>',r.setAttribute("aria-label","Python Script Run Button"),r.addEventListener("click",(async t=>{r.blur(),await e.handleEvent(t)})),r})(e,t),o=document.createElement("div");return o.addEventListener("keydown",(e=>{e.stopPropagation()})),r.append(n,o),r},f=(e,t)=>{const r=document.createElement("div");r.className=`${t}-editor-box`;const n=g(e,t),o=(e=>{const t=document.createElement("div");return t.className=`${e}-editor-output`,t.id=`${l(e)}-output`,t})(t);return r.append(n,o),[r,o,n.querySelector("button")]},h=async(e,o,s)=>{const[{basicSetup:i,EditorView:a},{Compartment:c},{python:d},{indentUnit:p},{keymap:g},{defaultKeymap:h,indentWithTab:v}]=await Promise.all([import("./codemirror-D5H78LwF.js"),import("./codemirror_state-D1qTXrff.js"),import("./codemirror_lang-python-BNKMM3aS.js"),import("./codemirror_language-CBQniB_I.js").then((function(e){return e.x})),import("./codemirror_view-BNvLVbLs.js").then((function(e){return e.q})),import("./codemirror_commands-BS7VlXdv.js")]);let y=e.hasAttribute("setup");const b=e.hasAttribute("config"),w=e.getAttribute("service-worker"),E=`${s}-${e.getAttribute("env")||l(o)}`;if(w&&(new t("data:application/javascript,postMessage(0)",{type:"dummy",serviceWorker:w}).onmessage=({target:e})=>e.terminate()),b&&u.has(E))throw new SyntaxError(u.get(E)?`duplicated config for env: ${E}`:`unable to add a config to the env: ${E}`);u.set(E,b);let $=e.src?await fetch(e.src).then((e=>e.text())):e.textContent;const k={handleEvent:m,serviceWorker:w,interpreter:s,env:E,config:b&&e.getAttribute("config"),get pySrc(){return y?$:P.state.doc.toString()},get outDiv(){return y?null:C}};let x;r(e,{target:{get:()=>x},handleEvent:{get:()=>k.handleEvent,set:e=>{k.handleEvent=e===m?m:async t=>{const{currentTarget:n}=t;r(t,{code:{value:k.pySrc}}),!1!==await e(t)&&await m.call(k,{currentTarget:n})}}},code:{get:()=>k.pySrc,set:e=>{y||P.update([P.state.update({changes:{from:0,to:P.state.doc.length,insert:e}})])}},process:{value(e){const t=y,r=$;y=!0,$=e;const n=()=>{y=t,$=r};return k.handleEvent({currentTarget:null}).then(n,n)}}});const A=()=>{const t=new Event(`${o}-editor`,{bubbles:!0});e.dispatchEvent(t)};if(y)return await k.handleEvent({currentTarget:null}),void A();const L=e.getAttribute("target");if(L){if(x=document.getElementById(L)||document.querySelector(L),!x)throw new Error(`Unknown target ${L}`)}else x=document.createElement(`${o}-editor`),x.style.display="block",e.after(x);x.id||(x.id=l(o)),x.hasAttribute("exec-id")||x.setAttribute("exec-id",0),x.hasAttribute("root")||x.setAttribute("root",x.id);const[S,C,T]=f(k,o);S.dataset.env=e.hasAttribute("env")?E:s;const j=S.querySelector(`.${o}-editor-input > div`).attachShadow({mode:"open"});j.innerHTML="<style> :host { all: initial; }</style>",x.appendChild(S);const M=n(e.textContent).trim(),R=/^([ \t]+)/m.test(M)?RegExp.$1:"    ",U=()=>T.click(),P=new a({extensions:[p.of(R),(new c).of(d()),g.of([...h,{key:"Ctrl-Enter",run:U,preventDefault:!0},{key:"Cmd-Enter",run:U,preventDefault:!0},{key:"Shift-Enter",run:U,preventDefault:!0},v]),i],foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],parent:j,doc:M});P.focus(),A()};let v=0,y=Promise.resolve();const b=()=>{v=0,w()},w=()=>{if(!v){v=setTimeout(b,250);for(const[t,r]of e){const e=`script[type="${t}-editor"]`;for(const n of document.querySelectorAll(e))n.type+="-active",y=y.then((()=>h(n,t,r)))}return y}};new MutationObserver(w).observe(document,{childList:!0,subtree:!0});var E=w();export{E as default};
//# sourceMappingURL=py-editor-C2ERGt-I.js.map
